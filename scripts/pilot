#!/usr/bin/env bash
set -euo pipefail

cmd="${1:-}"
shift || true

case "$cmd" in
  comfy) exec /opt/pilot/comfy.sh "$@" ;;
  kohya) exec /opt/pilot/kohya.sh "$@" ;;
  diffpipe) exec /opt/pilot/diffusion-pipe.sh "$@" ;;
  jupyter) exec /opt/pilot/start-jupyter.sh "$@" ;;
  code) exec /opt/pilot/start-code-server.sh "$@" ;;
  urls)
    if [ -f /workspace/config/secrets.env ]; then
      source /workspace/config/secrets.env
      echo "Jupyter:     http://localhost:${JUPYTER_PORT:-8888}/lab?token=${JUPYTER_TOKEN}"
      echo "code-server: http://localhost:${CODE_SERVER_PORT:-8443}"
      echo "password:    ${CODE_SERVER_PASSWORD}"
      echo "ComfyUI:     http://localhost:${COMFY_PORT:-5555}"
      echo "Kohya:       http://localhost:${KOHYA_PORT:-6666}"
      echo "DiffPipe TB: http://localhost:${DIFFPIPE_PORT:-4444}"
    else
      echo "/workspace/config/secrets.env not found"
      exit 1
    fi
    ;;
  *)
    echo "usage: pilot {comfy|kohya|diffpipe|jupyter|code|urls} [args...]"
    exit 2
    ;;
esac
