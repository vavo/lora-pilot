services:
  lora-pilot:
    image: ${LORA_PILOT_IMAGE:-notrius/lora-pilot:latest}
    container_name: ${LORA_PILOT_CONTAINER_NAME:-lora-pilot-minimal}
    restart: unless-stopped
    
    # NO GPU - CPU only mode
    # Note: Resource limits via 'deploy' are ignored by local Docker Compose
    # Use Docker daemon limits or external orchestration for production resource control
    
    ports:
      # Only essential ports
      - "${PORTAL_PORT:-7878}:${PORTAL_PORT:-7878}"  # ControlPilot
      - "${JUPYTER_PORT:-8888}:${JUPYTER_PORT:-8888}"  # JupyterLab
      - "${AI_TOOLKIT_PORT:-8675}:${AI_TOOLKIT_PORT:-8675}"  # AI Toolkit UI
    
    volumes:
      - ./workspace:/workspace
    
    environment:
      - TZ=${TZ:-America/New_York}
      - PORTAL_PORT=${PORTAL_PORT:-7878}
      - JUPYTER_PORT=${JUPYTER_PORT:-8888}
      - AI_TOOLKIT_PORT=${AI_TOOLKIT_PORT:-8675}
      # CPU-only optimizations
      - OMP_NUM_THREADS=${OMP_NUM_THREADS:-4}
      - MKL_NUM_THREADS=${MKL_NUM_THREADS:-4}

networks:
  default:
    name: ${LORA_PILOT_NETWORK_NAME:-lora-pilot-minimal-network}
