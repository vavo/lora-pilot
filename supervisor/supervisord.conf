[supervisord]
nodaemon=true
user=pilot
logfile=/workspace/logs/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/workspace/logs

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:jupyter]
directory=/workspace
user=pilot
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/workspace/logs/jupyter.out.log
stderr_logfile=/workspace/logs/jupyter.err.log
command=/bin/bash -lc 'exec /opt/venvs/tools/bin/jupyter-lab --ip=0.0.0.0 --port="${JUPYTER_PORT:-8888}" --no-browser --ServerApp.token="${JUPYTER_TOKEN:-}" --ServerApp.allow_origin="*" --ServerApp.root_dir=/workspace'

[program:code-server]
directory=/workspace
user=pilot
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/workspace/logs/code-server.out.log
stderr_logfile=/workspace/logs/code-server.err.log
command=/bin/bash -lc 'exec /usr/bin/code-server --bind-addr 0.0.0.0:"${CODE_SERVER_PORT:-8443}" --auth password --disable-telemetry --user-data-dir "${CODE_SERVER_DATA_DIR:-/workspace/cache/code-server}" --config "${CODE_SERVER_CONFIG_DIR:-/workspace/config/code-server}/config.yaml" /workspace'

[program:comfy]
directory=/opt/pilot/repos/ComfyUI
user=pilot
autostart=true
autorestart=true
startsecs=5
stdout_logfile=/workspace/logs/comfy.out.log
stderr_logfile=/workspace/logs/comfy.err.log
command=/bin/bash -lc 'if [ -d /opt/pilot/repos/ComfyUI ]; then exec python main.py --listen 0.0.0.0 --port "${COMFY_PORT:-5555}"; else echo "ComfyUI not installed"; sleep 3600; fi'

[program:kohya]
directory=/opt/pilot/repos/kohya_ss
user=pilot
autostart=true
autorestart=true
startsecs=5
stdout_logfile=/workspace/logs/kohya.out.log
stderr_logfile=/workspace/logs/kohya.err.log
command=/bin/bash -lc 'if [ -d /opt/pilot/repos/kohya_ss ]; then export PYTHONPATH="/opt/pilot/repos/kohya_ss/sd-scripts:${PYTHONPATH:-}"; exec python kohya_gui.py --listen 0.0.0.0 --server_port "${KOHYA_PORT:-6666}"; else echo "kohya_ss not installed"; sleep 3600; fi'
