[supervisord]
nodaemon=true
user=pilot
logfile=/workspace/logs/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/workspace/logs

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:jupyter]
directory=/workspace
user=pilot
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/workspace/logs/jupyter.out.log
stderr_logfile=/workspace/logs/jupyter.err.log
command=/bin/bash -lc 'source /workspace/config/secrets.env 2>/dev/null || true; exec /opt/venvs/tools/bin/jupyter-lab --ip=0.0.0.0 --port="${JUPYTER_PORT:-8888}" --no-browser --ServerApp.token="${JUPYTER_TOKEN:-}" --ServerApp.allow_origin="*" --ServerApp.root_dir=/workspace'

[program:code-server]
directory=/workspace
user=pilot
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/workspace/logs/code-server.out.log
stderr_logfile=/workspace/logs/code-server.err.log
command=/bin/bash -lc 'source /workspace/config/secrets.env 2>/dev/null || true; export PASSWORD="${CODE_SERVER_PASSWORD:-$PASSWORD}"; exec /usr/bin/code-server --bind-addr 0.0.0.0:"${CODE_SERVER_PORT:-8443}" --auth password --disable-telemetry --user-data-dir "/workspace/cache/code-server" --extensions-dir "/workspace/cache/code-server/extensions" /workspace'

[program:comfyui]
directory=/workspace
user=pilot
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/workspace/logs/comfyui.out.log
stderr_logfile=/workspace/logs/comfyui.err.log
command=/bin/bash -lc 'exec /opt/pilot/comfy.sh'

[program:kohya]
directory=/workspace
user=pilot
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/workspace/logs/kohya.out.log
stderr_logfile=/workspace/logs/kohya.err.log
command=/bin/bash -lc 'exec /opt/pilot/kohya.sh'
